.SUFFIXES:

MOLFORGE_DIR = /home/Alessandro/ERC/MolForge
SRC_DIR = $(MOLFORGE_DIR)/src
MODULES_DIR = $(SRC_DIR)/Modules

INC_DIR = $(SRC_DIR)
LIB_DIR = $(SRC_DIR)

FC = mpif90
FFLAGS = -g -fmax-errors=10 -O3
FFLAGS += -I$(INC_DIR) -L$(LIB_DIR) -lscalapack -llapack -lMolForge

SCALAPACK_FLAG = GNU ## Has to be "MKL" or "GNU", any other value will default to GNU

SOURCES = def_lists.f90 def_random_numbers.f90 def_angmom.f90 def_general_types.f90 def_mpi.f90 def_blacs.f90 def_lapack.f90 def_orthonorm.f90 def_scalapack.f90 def_utils.f90 def_dist.f90 def_parser.f90 def_sparse.f90 def_stevens.f90 def_rotations.f90 def_nets.f90 def_bispectrum.f90 def_descriptors.f90 def_forcefields.f90 def_lattice.f90 def_atoms.f90 def_proj_disp.f90 def_exponential.f90 def_spinham.f90 def_phonons.f90 def_spinphonon.f90 def_spins_dist_rs.f90 def_hilbert_dist.f90 def_function.f90 def_grad.f90 def_swarm.f90 def_ff_training.f90 def_spinham_map.f90 def_pulses.f90

OBJECTS = $(subst .f90,.o,$(SOURCES))

all : libMolForge MolForge # Spiral PhonDy Tools reg-tests

MolForge : libMolForge 
	$(FC) $(FFLAGS) molforge_serial.f90 $(OBJECTS) -o $@

libMolForge : $(SOURCES)
	ar crv $@.a $(OBJECTS)

def_lists.f90 : def_lists.f90
def_lists.o : 
	$(FC) $(FFLAGS) -c $(subst .o,.f90,$@) 


def_random_numbers.f90 : def_random_numbers.o
def_random_numbers.o : 
	$(FC) $(FFLAGS) -c $(subst .o,.f90,$@)

def_angmom.o : 
	$(FC) $(FFLAGS) -c $(subst .o,.f90,$@)

def_general_types.o : 
	$(FC) $(FFLAGS) -c $(subst .o,.f90,$@)

def_mpi.o :
	$(FC) $(FFLAGS) -c $(subst .o,.f90,$@)

def_blacs.o : def_mpi.o 
	$(FC) $(FFLAGS) -c $(subst .o,.f90,$@)

def_lapack.o : 
	$(FC) $(FFLAGS) -c $(subst .o,.f90,$@)

def_orthonorm.o : def_lapack.o
	$(FC) $(FFLAGS) -c $(subst .o,.f90,$@)

def_scalapack.o : def_mpi.o def_blacs.o
	$(FC) $(FFLAGS) -c $(subst .o,.f90,$@)

def_utils.o : 
	$(FC) $(FFLAGS) -c $(subst .o,.f90,$@)

def_dist.o : def_utils.o
	$(FC) $(FFLAGS) -c $(subst .o,.f90,$@)

def_parser.o : 
	$(FC) $(FFLAGS) -c $(subst .o,.f90,$@)

def_sparse.o : def_lists.o def_mpi.o def_blacs.o
	$(FC) $(FFLAGS) -c $(subst .o,.f90,$@)

def_stevens.o : def_angmom.o
	$(FC) $(FFLAGS) -c $(subst .o,.f90,$@)

def_rotations.o: def_angmom.o
	$(FC) $(FFLAGS) -c $(subst .o,.f90,$@)

def_nets.o :
	$(FC) $(FFLAGS) -c $(subst .o,.f90,$@)

def_bispectrum.o : def_angmom.o
	$(FC) $(FFLAGS) -c $(subst .o,.f90,$@)

def_descriptors.o : def_bispectrum.o def_lapack.o
	$(FC) $(FFLAGS) -c $(subst .o,.f90,$@)

def_forcefields.o : def_nets.o def_descriptors.o
	$(FC) $(FFLAGS) -c $(subst .o,.f90,$@)

def_lattice.o : def_mpi.o def_lapack.o
	$(FC) $(FFLAGS) -c $(subst .o,.f90,$@)

def_atoms.o : def_lattice.o def_descriptors.o def_forcefields.o def_lists.o def_sparse.o def_mpi.o def_utils.o def_general_types.o
	$(FC) $(FFLAGS) -c $(subst .o,.f90,$@)

def_proj_disp.o : def_lapack.o
	$(FC) $(FFLAGS) -c $(subst .o,.f90,$@)

def_exponential.o : def_lists.o def_mpi.o def_blacs.o def_stevens.o def_rotations.o def_lapack.o def_utils.o 
	$(FC) $(FFLAGS) -c $(subst .o,.f90,$@)

def_spinham.o : def_lists.o def_mpi.o def_blacs.o def_utils.o def_stevens.o def_rotations.o def_lapack.o 
	$(FC) $(FFLAGS) -c $(subst .o,.f90,$@)

def_phonons.o : def_mpi.o def_lapack.o def_utils.o def_atoms.o def_lattice.o def_proj_disp.o
	$(FC) $(FFLAGS) -c $(subst .o,.f90,$@)

def_spinphonon.o : def_lists.o def_mpi.o def_dist.o def_blacs.o def_spinham.o def_stevens.o def_phonons.o def_proj_disp.o
	$(FC) $(FFLAGS) -c $(subst .o,.f90,$@)

def_spins_dist_rs.o : def_mpi.o def_blacs.o def_lattice.o def_spinham.o def_spinphonon.o 
	$(FC) $(FFLAGS) -c $(subst .o,.f90,$@)

def_hilbert_dist.o : def_mpi.o def_blacs.o def_lapack.o def_scalapack.o def_lists.o def_sparse.o def_dist.o def_utils.o def_lattice.o def_atoms.o def_phonons.o def_spinham.o def_spinphonon.o def_spins_dist_rs.o def_exponential.o def_pulses.o 
	$(FC) $(FFLAGS) -c $(subst .o,.f90,$@)

def_function.o : 
	$(FC) $(FFLAGS) -c $(subst .o,.f90,$@)

def_grad.o : def_function.o def_random_numbers.o
	$(FC) $(FFLAGS) -c $(subst .o,.f90,$@)

def_swarm.o : def_function.o def_random_numbers.o
	$(FC) $(FFLAGS) -c $(subst .o,.f90,$@)

def_ff_training.o : def_nets.o def_function.o def_atoms.o def_general_types.o def_random_numbers.o
	$(FC) $(FFLAGS) -c $(subst .o,.f90,$@)

def_spinham_map.o : def_lapack.o def_angmom.o def_stevens.o def_swarm.o def_orthonorm.o def_hilbert_dist.o
	$(FC) $(FFLAGS) -c $(subst .o,.f90,$@)

def_pulses.o : def_mpi.o def_blacs.o def_lists.o
	$(FC) $(FFLAGS) -c $(subst .o,.f90,$@)




clean : 
	rm -f $(SRC_DIR)/*.o $(SRC_DIR)/*.mod libMolForge.a MolForge

